---
title: Kotlin Standard.kt ä¸­çš„å‡½æ•°
date: 2021-06-24
tags: Kotlin
---

åœ¨ Kotlin ä¸­æœ‰ä¸€ä¸ª Standard.kt çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ Kotlin çš„æ ‡å‡†åº“ï¼Œé‡Œé¢æ˜¯æˆ‘ä»¬å¹³æ—¶ç»å¸¸ä½¿ç”¨çš„å‡½æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬ä½œç”¨åŸŸå‡½æ•°ã€å¯¹è±¡çŠ¶æ€æ£€æŸ¥å‡½æ•°ã€`TODO()`å‡½æ•°ã€‚

## ä½œç”¨åŸŸå‡½æ•°

åœ¨ Kotlin ä¸­æœ‰å‡ ä¸ªä½œç”¨åŸŸå‡½æ•°ï¼Œå½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡è°ƒç”¨è¿™äº›å‡½æ•°æ—¶ï¼Œä¼šå½¢æˆä¸€ä¸ªä¸´æ—¶ä½œç”¨åŸŸï¼Œå¯ä»¥åœ¨ä¼ å…¥çš„ lambda è¡¨è¾¾å¼ä¸­ä½¿ç”¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ã€‚

æ¯ä¸ªä½œç”¨åŸŸå‡½æ•°çš„æœ¬è´¨éƒ½å¾ˆç›¸è¯†ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢æ¥åšåŒºåˆ«ï¼š
- ä¸Šä¸‹æ–‡å¯¹è±¡çš„å¼•ç”¨æ–¹å¼
- lambda è¡¨è¾¾å¼çš„è¿”å›å€¼

| å‡½æ•°å | ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ | è¿”å›å€¼ | æ˜¯å¦ä¸ºæ‰©å±•å‡½æ•° |
| --- | --- | --- | --- |
| let | it | Lambda è¡¨è¾¾å¼ç»“æœ | æ˜¯ |
| run | this | Lambda è¡¨è¾¾å¼ç»“æœ | æ˜¯ |
| run | - | Lambda è¡¨è¾¾å¼ç»“æœ | ä¸æ˜¯ï¼šè°ƒç”¨æ— éœ€ä¸Šä¸‹æ–‡å¯¹è±¡ |
| with | this | Lambda è¡¨è¾¾å¼ç»“æœ | ä¸æ˜¯ï¼šæŠŠä¸Šä¸‹æ–‡å¯¹è±¡å½“åšå‚æ•° |
| apply | this | ä¸Šä¸‹æ–‡å¯¹è±¡ | æ˜¯ |
| also | it | ä¸Šä¸‹æ–‡å¯¹è±¡ | æ˜¯ |

## let

```Kotlin
@kotlin.internal.InlineOnly
public inline fun <T, R> T.let(block: (T) -> R): R {
    // ...
    return block(this)
}
```

**let** ä¼šå°† lambda è¡¨è¾¾å¼çš„ç»“æœä½œä¸º`è¿”å›å€¼`ã€‚let è™½ç„¶æ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œä½†ä¸ä¼šå±è”½å¤–éƒ¨å¯¹è±¡çš„ thisã€‚åœ¨ lambda è¡¨è¾¾å¼é‡Œé¢å¦‚æœä½¿ç”¨ this æ‰€è®¿é—®çš„æ˜¯å¤–éƒ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¥æ”¶è€…å¯¹è±¡ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä½¿ç”¨æ¥æ”¶è€…å»è°ƒç”¨æˆ‘ä»¬æ‰€ä¼ å…¥çš„ lambda è¡¨è¾¾å¼ã€‚

æˆ‘ä»¬å¯ä»¥ä¸º lambda è¡¨è¾¾å¼æŒ‡å®šä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡çš„å¼•ç”¨åç§°ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤ä½¿ç”¨ `it` æ¥ä½œä¸ºä¸Šä¸‹æ–‡å¯¹è±¡çš„å¼•ç”¨ã€‚æˆ‘ä»¬ç»å¸¸é…åˆç©ºå®‰å…¨è°ƒç”¨æ“ä½œç¬¦ `?.` æ¥ä½¿ç”¨ let è°ƒç”¨ä¸€ä¸ªå¯ç©ºå¯¹è±¡çš„å±æ€§ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œæˆ‘ä»¬é€šè¿‡ JSON å­—ç¬¦ä¸²å¯¹è±¡è·å–åˆ°ä¸€ä¸ª Food åˆ—è¡¨ï¼Œå½“ç„¶å¯èƒ½è·å–ä¸åˆ°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¯¹è¿™ä¸ª Food åˆ—è¡¨è¿›è¡Œä¸€äº›æ“ä½œã€‚å¦‚æœä¸å€ŸåŠ© let æˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºå¦‚ä¸‹ä»£ç ã€‚

```Kotlin
val foods = jsonObj.getList("foods")
var biggest:Chestnut? = null

if (foods != null) {
    foodStorage.storeChestnut(foods)
    biggest = biggestChestnuts(foods)
}
```

å¦‚æœè¿™é‡Œçš„ `foods` åªæ˜¯ç”¨åœ¨ if çš„ä»£ç å—ä¸­ï¼Œå¹¶æ²¡æœ‰ç”¨äºå…¶å®ƒåœ°æ–¹ï¼Œæ­¤æ—¶å°±å¯ä»¥å€ŸåŠ© let æ¥ç§»é™¤å¤šä½™çš„å˜é‡å®šä¹‰ï¼Œé…åˆç©ºå®‰å…¨è°ƒç”¨ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `foods` ä¸ä¸º `null` çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä¼ å…¥ lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç ï¼Œå¹¶åœ¨ let è¯­å¥çš„æœ€åå°† `biggestChestnut(foods)` çš„ç»“æœè¿”å›ï¼ŒKotlin ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œä¸éœ€è¦æˆ‘ä»¬å»è¿›è¡ŒæŒ‡å®šã€‚

```Kotlin
var biggest = jsonObj.getList("foods")?.let {
    foodStorage.storeChestnuts(it)
    biggestChestnut(it)
}
```

æœ‰æ—¶å€™ it å¹¶ä¸èƒ½å¾ˆå¥½ä½“ç°ä¸€ä¸ªå¯¹è±¡ï¼Œå°¤å…¶æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯é€šè¿‡è¿ç»­çš„è°ƒç”¨è·å–åˆ°çš„ï¼Œæˆ–è€… let ä¸­çš„ä»£ç æ¯”è¾ƒé•¿çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¢åŠ ä»£ç çš„å¯è¯»æ€§ï¼Œä¸ºä¸Šä¸‹æ–‡å¯¹è±¡å®šä¹‰ä¸€ä¸ªæ–°å˜é‡æ¥ä»£æ›¿é»˜è®¤çš„ itï¼Œå¯ä»¥å°†å˜é‡åç§°ä½œä¸º lambda è¡¨è¾¾å¼å‚æ•°ä¼ å…¥ï¼Œæ­¤æ—¶æ”¹å‚æ•°å°†ä½œä¸ºä¸Šä¸‹æ–‡å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸èƒ½ä½¿ç”¨ `it`ã€‚

```Kotlin
var biggest = jsonObj.getList("foods")?.let { foods ->
    foodStorage.storeChestnuts(foods)
    biggestChestnut(foods)
    // do more ...
}
```

## run

```Kotlin
@kotlin.internal.InlineOnly
public inline fun <T, R> T.run(block: T.() -> R): R {
    // ...
    return block()
}
```

**run** å’Œ let ä¸€æ ·è¿”å›å€¼éƒ½æ˜¯ lambda è¡¨è¾¾å¼çš„ç»“æœã€‚run å®šä¹‰çš„å‡½æ•°å‚æ•° `block` æ˜¯ä¸€ä¸ªæ— å‚çš„æ‰©å±•å‡½æ•°ï¼Œå› æ­¤ä¸ä¼šåƒ let ä¸€æ ·å°†å½“å‰çš„ä¸Šä¸‹æ–‡å¯¹è±¡ `this` ä¼ å…¥ `block` ä¸­ï¼Œå®ƒåœ¨ lambda è¡¨è¾¾å¼ä¸­çš„ä¸Šä¸‹æ–‡å¯¹è±¡å¼•ç”¨ç›´æ¥ä½¿ç”¨ `this`ã€‚

run çš„ lambda è¡¨è¾¾å¼å¯ä»¥ä¸é€šè¿‡ `this` ç›´æ¥ä½¿ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡çš„å±æ€§ï¼Œå› æ­¤å®ƒåœ¨ lambda è¡¨è¾¾å¼ä¸­åŒæ—¶åŒ…å«è¿”å›å€¼çš„è®¡ç®—å’Œå¯¹è±¡åˆå§‹åŒ–æˆ–å±æ€§è°ƒç”¨æ—¶ï¼Œéå¸¸é€‚åˆä½¿ç”¨ runã€‚

æˆ‘ä»¬å¯ä»¥ä¸¾ä¸ªğŸŒ°æ¥å¯¹æ¯”ä¸€ä¸‹ï¼šå¯¹ä¸€é¢—æ —å­å‰¥çš®ï¼Œç„¶åè·å–è¿™é¢—æ —å­çš„è¯„ä»·ã€‚

```Kotlin
// ä½¿ç”¨ let
appraise = chestnut.let {
    it.debark() // å‰¥çš®
    Appraisal.check(it.flavour, it.weight) // è¯„ä»·
}

// ä½¿ç”¨ run å¯ä»¥æ›´åŠ æ–¹ä¾¿è°ƒç”¨ä¸Šä¸‹æ–‡å¯¹è±¡çš„å±æ€§
appraise = chestnut.run {
    debark()
    Appraisal.check(flavour, weight)
}
```

æ­¤å¤–ï¼Œrun è¿˜æœ‰ä¸€ä¸ªéæ‰©å±•å‡½æ•°çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä¸ç”¨åœ¨æ¥æ”¶è€…å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œç›´æ¥æ‰§è¡Œå¤šä¸ªè¯­å¥ç»„æˆçš„ä»£ç å—ã€‚

```Kotlin
@kotlin.internal.InlineOnly
public inline fun <R> run(block: () -> R): R {
    // ...
    return block()
}
```

## with

**with** å’Œ run çš„ä½œç”¨ä¸€æ ·ï¼Œå®˜æ–¹ä»è¯­ä¹‰ä¸Šç†è§£ä¸º *â€œå¯¹äºè¿™ä¸ªå¯¹è±¡ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚â€*ï¼Œè¿”å›å€¼æ˜¯ lambda è¡¨è¾¾å¼çš„ç»“æœã€‚

```Kotlin
@kotlin.internal.InlineOnly
public inline fun <T, R> with(receiver: T, block: T.() -> R): R {
    // ...
    return receiver.block()
}
```

å’Œ run ä¸åŒçš„æ˜¯ï¼Œwith å¹¶ä¸æ˜¯æ‰©å±•å‡½æ•°ï¼Œå®ƒå°†ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œä¼ å…¥çš„ `block` æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡çš„æ‰©å±•å‡½æ•°ï¼Œåœ¨ with å†…éƒ¨ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…è°ƒç”¨ `block`ï¼Œå› æ­¤åœ¨ lambda è¡¨è¾¾å¼å†…éƒ¨ä¾æ—§å¯ä»¥åƒæ‰©å±•å‡½æ•°çš„æ¥æ”¶è€…ä¸€æ ·ä½¿ç”¨ this æ¥è®¿é—®ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚

```Kotlin
appraise = with(chestnut){
    debark()
    Appraisal.check(flavour, weight)
}
```

## apply

```Kotlin
@kotlin.internal.InlineOnly
public inline fun <T> T.apply(block: T.() -> Unit): T {
    // ...
    block()
    return this
}
```

**apply** æ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºæ¥æ”¶è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ this æ¥è®¿é—®ï¼ŒåŒæ—¶ä¸Šä¸‹æ–‡å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™å’Œ runã€with ä¸€æ ·ã€‚ä½† apply çš„è¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ apply åœ¨è·å–ä¸Šä¸‹æ–‡å¯¹è±¡æ—¶åšä¸€äº›é™„åŠ çš„æ“ä½œï¼Œä¾‹å¦‚å¯¹è±¡é…ç½®ã€‚

æˆ‘ä»¬è¯•ç€åˆ›å»ºä¸€ä¸ªé¦™å–·å–·ä¸”å·²ç»å‰¥äº†çš®çš„æ —å­ğŸŒ°ï¼ˆChestnutï¼‰

```Kotlin
val chestnut = Chestnut().apply {
    flavour = SWEET
    debark()
}
```

## also

```Kotlin
@kotlin.internal.InlineOnly
@SinceKotlin("1.1")
public inline fun <T> T.also(block: (T) -> Unit): T {
    // ...
    block(this)
    return this
}
```

**also** çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¼šä½œä¸º lambda è¡¨è¾¾å¼çš„å‚æ•°ä¼ å…¥ï¼Œä½¿ç”¨ it æ¥è®¿é—®ï¼Œè€Œè¿”å›å€¼æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡æœ¬èº«ã€‚

å½“æˆ‘ä»¬ä¸æƒ³å±è”½å¤–éƒ¨çš„ `this`ï¼Œæˆ–è€…åœ¨è·å–è¯¥å¯¹è±¡æ—¶éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡è¿›è¡Œä¸€äº›å…¶å®ƒæ“ä½œæ—¶ï¼Œé€‚åˆç”¨ alsoã€‚

```Kotlin
val chestnut = Chestnut().also {
    println("æ‹¿åˆ°äº†ä¸€ä¸ªæ–°çš„æ —å­ğŸŒ°ï¼š $it")
    FoodStorage.add(it)
}
```

## å¯¹è±¡çŠ¶æ€æ£€æŸ¥å‡½æ•°

***å¯¹è±¡çŠ¶æ€æ£€æŸ¥** ä¸€è¯æ¥è‡ª [Kotlin è¯­è¨€ä¸­æ–‡ç«™æ–‡æ¡£](https://www.kotlincn.net/docs/reference/scope-functions.html)*

Kotlin æ ‡å‡†åº“ä¸­çš„å¯¹è±¡çŠ¶æ€æ£€æŸ¥å‡½æ•°æœ‰ 2 ä¸ªï¼š`takeIf` ä¸ `takeUnless`ã€‚å®ƒä»¬å¯ä»¥è®©å¯¹è±¡çŠ¶æ€çš„æ£€æŸ¥åŠ å…¥åˆ°è°ƒç”¨é“¾ä¸­ã€‚

```Kotlin
@kotlin.internal.InlineOnly
@SinceKotlin("1.1")
public inline fun <T> T.takeIf(predicate: (T) -> Boolean): T? {
    // ...
    return if (predicate(this)) this else null
}

@kotlin.internal.InlineOnly
@SinceKotlin("1.1")
public inline fun <T> T.takeUnless(predicate: (T) -> Boolean): T? {
    // ...
    return if (!predicate(this)) this else null
}
```

`takeIf` å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯¹è±¡è¿‡æ»¤å™¨ï¼Œæ¥æ”¶çš„ lambda è¡¨è¾¾å¼çš„ç»“æœå¿…é¡»æ˜¯ Boolean ç±»å‹ï¼Œå½“è¿™ä¸ªç»“æœä¸º `true` æ—¶ï¼Œåˆ™è¿”å›å¯¹è±¡æœ¬èº«ï¼Œå¦åˆ™è¿”å› `null`ã€‚

```Kotlin
// è·å–å¤§äº 50 çš„å¶æ•°
val number = Random.nextInt(100)

val result = number.takeIf {
    val r1 = it % 2 == 0
    val r2 = it > 50
    r1 && r2
}

println("number: $number | result: $result")
// number: 91 | result: null
```

è€Œ `takeUnless` åˆ™äº `takeIf` ç›¸åï¼Œå½“ç»“æœæ˜¯ `false` æ—¶æ‰è¿”å›å¯¹è±¡æœ¬èº«ï¼Œå¦åˆ™è¿”å› `null`

```Kotlin
val number = Random.nextInt(100).takeUnless {
    it > 50 && it % 2 == 0
}
println("number: $number")
// number: 34
```

## TODO

Kotlin çš„ `TODO()` ä¹Ÿæ˜¯å±äº Standard.kt ä¸­çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬åœ¨å®šä¹‰æ–¹æ³•ä½†é€»è¾‘æš‚æ—¶è¿˜ä¸éœ€è¦å®ç°æˆ–éœ€è¦å…ˆå»å®Œæˆå…¶å®ƒä»£ç çš„æ—¶å€™ï¼Œä»£æ›¿åº”å½“å­˜åœ¨çš„ä»£ç è¿›è¡Œå ä½ã€‚

ä½¿ç”¨ `TODO()` å ä½çš„æ–¹æ³•ä¸ä¼šå› ä¸ºç±»å‹æˆ–è¿”å›å€¼è¿™äº›å¾…å®ç°é—®é¢˜è€Œè¢« IDEA è­¦å‘Šï¼Œå› æ­¤å³ä¾¿æ²¡æœ‰æ­£ç¡®çš„è¿”å›å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‰§è¡Œåˆ°äº† `TODO()` çš„è¯ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª `NotImplementedError` é”™è¯¯ï¼Œæ¥å‘ŠçŸ¥å¼€å‘è€…è¿™ä¸ªåœ°æ–¹è¿˜æ²¡æœ‰è¿›è¡Œå®ç°ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ `TODO()` ä¸­ä¼ å…¥ä¸€ä¸ª reason å‚æ•°æ¥æç¤ºæœªå®ç°åŸå› ã€‚

```Kotlin
fun mustTodo(): String {
    TODO("è¿˜æ²¡å®ç°çš„é€»è¾‘")
}

fun main() {
    mustTodo()
}

/*
Exception in thread "main" kotlin.NotImplementedError:
    An operation is not implemented: è¿˜æ²¡å®ç°çš„é€»è¾‘
*/
```

## å‚è€ƒ

> [ä½œç”¨åŸŸå‡½æ•° - Kotlin è¯­è¨€ä¸­æ–‡ç«™ (kotlincn.net)](https://www.kotlincn.net/docs/reference/scope-functions.html)
